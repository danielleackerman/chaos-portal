# v3.73 STYLE-SYSTEM-RESET

## Purpose
This project is standardizing styling so that:

- Styles are predictable and searchable.
- The Style Guide is a reliable source of truth.
- Styling does not depend on Astro-scoped `<style>` blocks (avoids `data-astro-cid...` surprises).
- Components remain Astro components, but their CSS lives in external files.

This is a **mechanical refactor**. It is *not* a redesign.

---

## Definitions

### Tokens
Global design values, mostly CSS variables:

- colors
- typography tokens
- radii
- shadows
- spacing scale

**Tokens do not style specific components.**

### Patterns (CSS-only)
Reusable HTML “recipes” defined by classes and documented in the Style Guide. Patterns are **not** Astro components.

Examples:

- Heroes
- Callouts
- Breadcrumb
- Section Nav
- Tags/Tokens
- Dimension Card wrappers

### Components (Astro)
Reusable UI blocks that render markup + classes and often include behavior. Components are `.astro` files.

Examples:

- Tabs
- Accordion
- ExpandingCards
- FlipCard
- CoordinatePicker

---

## Target Directory Structure

```
src/styles/
  global.css              <-- import hub
  tokens.css              <-- CSS variables (project tokens)
  base.css                <-- element defaults / baseline typography
  patterns/
    dimension-card.css
    hero.css
    callouts.css
    breadcrumb.css
    section-nav.css
    tags.css
  components/
    coordinate-picker.css
    tabs.css
    accordion.css
    expanding-cards.css
    flip-card.css
```

---

## Non-Negotiable Rules

### 1) No scoped `<style>` blocks in `.astro` components
- All component CSS lives in `src/styles/components/<component>.css`.
- All pattern CSS lives in `src/styles/patterns/<pattern>.css`.
- Only temporary debug styles are allowed during development, and **must be removed before merge**.

### 2) `src/styles/global.css` is the import hub
- `global.css` imports tokens/base first.
- Then imports patterns.
- Then imports components.

Example import order:

```css
@import "./tokens.css";
@import "./base.css";

/* patterns */
@import "./patterns/dimension-card.css";
@import "./patterns/hero.css";
@import "./patterns/callouts.css";

/* components */
@import "./components/coordinate-picker.css";
@import "./components/tabs.css";
@import "./components/accordion.css";
@import "./components/expanding-cards.css";
@import "./components/flip-card.css";
```

### 3) Keep classnames stable (avoid churn)
- Prefer keeping existing class names used in markup.
- If duplicates exist (same class defined in multiple places), consolidate into the correct pattern/component file.
- Do not rename selectors unless required to remove duplicates or fix collisions.

### 4) Variations live inside the same CSS file
No “one CSS file per variation.” Use data attributes or modifier classes.

Example:

```css
.tabs[data-tone="quiet"] { /* ... */ }
.tabs[data-tone="loud"]  { /* ... */ }
```

### 5) The Style Guide demonstrates; it does not own shared styling
- Style Guide may include *layout-only* demo scaffolding (grids, spacing, demo frames).
- The “real” styling for shared patterns/components must live in `patterns/` and `components/` and be imported by `global.css`.

---

## Naming Conventions

### CSS file names
- `kebab-case.css`
- One file per pattern/component.

### Class names
- Preserve existing names where possible.
- If introducing new names, use:
  - `block`
  - `block__element`
  - `block--modifier`

### Variation controls
Preferred:
- `data-*` attributes (`data-tone`, `data-density`, `data-size`)

Acceptable:
- modifier classes (`.callout--warning`)

---

## Component Contract (Astro + External CSS)

### Component responsibilities
- Markup structure
- Stable root class
- Props that set classes/data-attributes
- Behavior (JS) if needed

**Not responsible for where styling lives.**

Example:

```astro
---
const { tone = "neutral" } = Astro.props;
---

<div class="coord-picker" data-tone={tone}>
  <slot />
</div>
```

CSS lives at:
- `src/styles/components/coordinate-picker.css`

---

## Pattern Contract (HTML + Global CSS)

Patterns are plain HTML with classes.

Example Dimension Card:

```html
<div class="dimension-card">
  <span class="dimension-number">SURFACE DIMENSION 5</span>
  <h2 class="dimension-title">Expressive / Symbolic</h2>
  <p class="dimension-position">What you directly see and hear</p>
  <p>Observable phenomena...</p>
</div>
```

CSS lives at:
- `src/styles/patterns/dimension-card.css`

---

## Migration Playbook (Mechanical Refactor)

### Step 1 — Create folders
- `src/styles/patterns/`
- `src/styles/components/`

### Step 2 — Update `global.css` imports
- Ensure tokens/base imports remain intact.
- Add patterns imports.
- Add components imports.
- Keep import order consistent: tokens/base → patterns → components.

### Step 3 — Move pattern CSS out of pages
- Find pattern rules in any page-scoped `<style>` blocks (especially the Style Guide).
- Cut rules → paste into the correct `patterns/*.css` file.
- Delete duplicates from the page.

### Step 4 — Move component CSS out of components
For each `.astro` component:
- Find its `<style>` block.
- Cut rules → paste into `components/<name>.css`.
- Delete the `<style>` block.
- Verify markup class names still match the CSS.

### Step 5 — Remove duplicates
Search for duplicates by class name (examples):

- `.dimension-card`
- `.coord-picker`
- `.tabs`
- `.accordion`
- `.expanding-cards`

Each shared selector should have **one** home file.

---

## “No Double-Chrome” Rule (Card Wrappers)

When a component is placed inside a “card pattern” (like `.dimension-card`), the component must not draw another card unless explicitly intended.

Preferred approach:
- Components render neutral internals by default.
- Card wrapper patterns provide the chrome.

If a component currently draws its own panel chrome, remove that chrome from the component CSS and rely on patterns for presentation.

---

## Acceptance Checklist (Must Pass)

### Structural
- [ ] No `<style>` blocks remain in `src/components/**/*.astro`
- [ ] `global.css` imports patterns/components consistently
- [ ] Each shared selector has one CSS home

### Visual/Behavior
- [ ] Style Guide still matches pre-refactor appearance (no redesign)
- [ ] Tabs still work
- [ ] Accordion still works (if present)
- [ ] ExpandingCards still works
- [ ] CoordinatePicker sits cleanly inside `.dimension-card` without double border/padding

### Debugging quick checks
- In DevTools, rules should point to real files like:
  - `global.css`
  - `patterns/*.css`
  - `components/*.css`
  (not inline component-scoped blocks)

---

## Notes
This reset is about **stability and velocity**.

After this baseline is merged, future work should:
- add patterns/components by creating one CSS file + importing it in `global.css`
- document usage in the Style Guide
- avoid creating page-local styling for shared UI
