---
import PortalLayout from '../layouts/PortalLayout.astro';
import { getCategoryStats } from '../data/library.js';

const musicStats = getCategoryStats('music');
const storyStats = getCategoryStats('story');
const totalLinks = musicStats.links + storyStats.links;
const totalPages = musicStats.pages + storyStats.pages;
const base = import.meta.env.BASE_URL;
const b = base.replace(/\/$/, '');

const modules = [
  {
    key:      'compass',
    title:    'Story Coordinate Compass',
    desc:     '8 sections · Complete framework',
    href:     `${b}/compass/`,
    color:    'var(--module-compass)',
    live:     true,
    compass:  true,
    icon: `<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><polygon points="16.24 7.76 14.12 14.12 7.76 16.24 9.88 9.88 16.24 7.76"/></svg>`,
  },
  {
    key:      'library',
    title:    'Library',
    desc:     `${totalLinks} resources · ${totalPages} pages`,
    href:     `${b}/library/music/`,
    color:    'var(--module-library)',
    live:     true,
    icon: `<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="4" height="18" rx="1"/><rect x="9" y="3" width="4" height="18" rx="1"/><path d="M15 5l4 14"/></svg>`,
  },
  {
    key:      'engine',
    title:    'Creativity Engine',
    desc:     'Songwriting dashboard — generative tools for ideation',
    href:     null,
    color:    'var(--module-engine)',
    live:     false,
    icon: `<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/></svg>`,
  },
  {
    key:      'pipeline',
    title:    'Corpus → Opus Pipeline',
    desc:     'Execution pipeline from raw material to finished work',
    href:     null,
    color:    'var(--module-pipeline)',
    live:     false,
    icon: `<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14"/><path d="M12 5v14"/><circle cx="5" cy="12" r="2"/><circle cx="19" cy="12" r="2"/><circle cx="12" cy="5" r="2"/><circle cx="12" cy="19" r="2"/></svg>`,
  },
  {
    key:      'piano',
    title:    'Piano Exercise Matrix',
    desc:     'Exercises indexed by technique, key, and difficulty',
    href:     null,
    color:    'var(--module-piano)',
    live:     false,
    icon: `<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="5" width="20" height="14" rx="1"/><path d="M7 5v8M12 5v8M17 5v8"/><path d="M9.5 5v5M14.5 5v5"/></svg>`,
  },
  {
    key:      'vocal',
    title:    'Vocal Exercise Matrix',
    desc:     'Warm-ups mapped by range, register, and goal',
    href:     null,
    color:    'var(--module-vocal)',
    live:     false,
    icon: `<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z"/><path d="M19 10v2a7 7 0 0 1-14 0v-2"/><line x1="12" x2="12" y1="19" y2="22"/></svg>`,
  },
  {
    key:      'songs',
    title:    'Source of Truth: Songs',
    desc:     'Master registry — lyrics, structure, versions, metadata',
    href:     null,
    color:    'var(--module-songs)',
    live:     false,
    icon: `<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 18V5l12-2v13"/><circle cx="6" cy="18" r="3"/><circle cx="18" cy="16" r="3"/></svg>`,
  },
  {
    key:      'staircase',
    title:    'Staircase to My Biggest Why',
    desc:     'Framework for clarifying purpose, values, and creative vision',
    href:     null,
    color:    'var(--module-staircase)',
    live:     false,
    icon: `<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 19h4v-4h4v-4h4V7h4"/><path d="M3 19V5"/></svg>`,
  },
];
---

<PortalLayout title="Home" currentPage="home">

  <!-- Hero — preserved -->
  <div style="text-align:center; padding:3.5rem 0 3rem;">
    <div class="eyebrow eyebrow--amber" style="font-size:0.6875rem; letter-spacing:0.15em; text-transform:uppercase; font-weight:600; margin-bottom:1rem; color:var(--semantic-h);">
      CREATIVE FRAMEWORK PORTAL
    </div>
    <h1 style="margin-bottom:1rem;">Story <strong>&</strong> Music</h1>
    <p style="font-size:1.0625rem; color:var(--text-2); max-width:500px; margin:0 auto; line-height:1.6;">
      A coordinate system for navigating narrative structure, music theory, and the bridges between them.
    </p>
  </div>

  <!-- Module grid — 8 cards, single unified grid -->
  <div class="module-grid animate-in">
    {modules.map((m) => {
      const Tag = m.live ? 'a' : 'div';
      const extraClass = m.compass ? ' cat-card--compass' : '';
      const props = m.live
        ? { href: m.href }
        : { 'aria-disabled': 'true' };

      return (
        <Tag
          class={`cat-card cat-card--module${extraClass}`}
          style={`--module-color:${m.color}`}
          {...props}
        >
          <div class="cat-card__icon" set:html={m.icon} aria-hidden="true" />
          <div class="cat-card__title">{m.title}</div>
          <div class="cat-card__count">
            {m.live ? m.desc : <span class="status-tag status-tag--coming">Coming Soon</span>}
          </div>
        </Tag>
      );
    })}
  </div>

</PortalLayout>
