/* ================================================================
   EXPANDING CARDS — Base Component
   Shared by all ExpandingCards instances (horizontal + vertical,
   simple items + slotted rich content).
   ================================================================ */

/* ── Deck container ── */
.expanding-cards {
  display: flex;
  gap: var(--space-xs);
  margin: 1rem 0 1.75rem;
}

.expanding-cards--vertical {
  flex-direction: row;
}

.expanding-cards--horizontal {
  flex-direction: column;
}

/* ── Card (shared base) ── */
.expanding-cards__card {
  position: relative;
  border: 1px solid var(--border);
  border-radius: var(--radius-md);
  background: var(--surface-elevated);
  padding: 0.95rem 1rem;
  cursor: pointer;
  overflow: hidden;
  min-height: 120px;
  transition: flex 0.35s ease, box-shadow 0.25s ease, background 0.25s ease;
}

.expanding-cards__card:focus-visible {
  outline: 2px solid var(--info-blue);
  outline-offset: 2px;
}

/* Collapsed sizing — vertical (side-by-side) */
.expanding-cards--vertical .expanding-cards__card {
  flex: 0.7;
}

/* Collapsed sizing — horizontal (stacked) */
.expanding-cards--horizontal .expanding-cards__card {
  flex: 0 0 68px;
  min-height: 68px;
}

/* ── Label ── */
.expanding-cards__label {
  font-family: var(--font-mono);
  font-size: 0.75rem;
  font-weight: 800;
  letter-spacing: 0.08em;
  text-transform: uppercase;
  color: var(--text-2);
}

.expanding-cards--vertical .expanding-cards__label {
  writing-mode: vertical-rl;
  text-orientation: mixed;
}

.expanding-cards--horizontal .expanding-cards__label {
  writing-mode: horizontal-tb;
}

/* ── Content (collapsed = hidden) ── */
.expanding-cards__content {
  max-height: 0;
  opacity: 0;
  overflow: hidden;
  transform: translateY(4px);
  transition: opacity 0.3s cubic-bezier(0.2, 0.8, 0.2, 1),
              max-height 0.38s cubic-bezier(0.2, 0.8, 0.2, 1),
              transform 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
}

.expanding-cards__content h4 {
  margin: 0 0 0.35rem;
  text-transform: none;
  letter-spacing: 0;
  font-size: 1rem;
}

.expanding-cards__content p {
  margin: 0;
  font-size: 0.92rem;
  line-height: 1.5;
}

/* ── State: collapsed ── */
.expanding-cards__card[aria-expanded='false'] {
  background: var(--accent-fill, var(--surface-elevated));
}

/* ── State: expanded ── */
.expanding-cards__card[aria-expanded='true'] {
  background: var(--surface);
  box-shadow: var(--shadow-card);
  cursor: default;
}

.expanding-cards--vertical .expanding-cards__card[aria-expanded='true'] {
  flex: 2.3;
  border-left: 6px solid var(--accent-fill, var(--border-accent));
}

.expanding-cards--horizontal .expanding-cards__card[aria-expanded='true'] {
  flex-basis: 176px;
  border-top: 6px solid var(--accent-fill, var(--border-accent));
}

.expanding-cards__card[aria-expanded='true'] .expanding-cards__content {
  max-height: 600px;
  opacity: 1;
  transform: translateY(0);
}

/* ── Coordinate Picker integration ── */
.expanding-cards__card.dimension-highlighted {
  position: relative;
  z-index: 1;
  box-shadow: 0 0 0 2px var(--semantic-v), 0 4px 16px rgba(20, 184, 166, 0.15);
}

.expanding-cards__card.dimension-dimmed {
  opacity: 0.35;
  transition: opacity 0.3s ease;
}

.expanding-cards__card.dimension-dimmed:hover {
  opacity: 0.7;
}

/* ── Layout helper ── */
@media (max-width: 768px) {
  .fixed-cols {
    grid-template-columns: 1fr;
  }
}


/* ================================================================
   ===== Vertical Axis: Expanding Cards (variation) =====

   Slotted-mode overrides for the rich-content deck used on the
   Vertical Axis page (/compass/vertical-axis/expanding-cards).

   All selectors gated under .expanding-cards--slotted so they
   cannot affect simple ExpandingCards instances elsewhere.
   ================================================================ */

/* ── Depth-level accent fills ── */
.expanding-cards--slotted .expanding-cards__card[data-depth="5"] { --accent-fill: var(--dim-5); }
.expanding-cards--slotted .expanding-cards__card[data-depth="4"] { --accent-fill: var(--dim-4); }
.expanding-cards--slotted .expanding-cards__card[data-depth="3"] { --accent-fill: var(--dim-3); }
.expanding-cards--slotted .expanding-cards__card[data-depth="2"] { --accent-fill: var(--dim-2); }
.expanding-cards--slotted .expanding-cards__card[data-depth="1"] { --accent-fill: var(--dim-1); }
.expanding-cards--slotted .expanding-cards__card[data-depth="0"] { --accent-fill: var(--dim-0); }

/* ── Slotted animation tuning ──
   Animate flex (card width) + cosmetics only.
   Do NOT animate max-height — it causes layout thrash on every frame.  */
.expanding-cards--slotted .expanding-cards__card {
  transition: flex 340ms cubic-bezier(0.2, 0.8, 0.2, 1),
              box-shadow 260ms ease,
              border-color 260ms ease,
              background 260ms ease;
}

/* Slotted content: animate opacity + transform only — no max-height.
   The deck has a fixed height; content fills it and scrolls if needed.
   This eliminates the per-frame reflow that caused jank.               */
.expanding-cards--slotted .expanding-cards__content {
  transition: opacity 260ms ease,
              transform 260ms cubic-bezier(0.2, 0.8, 0.2, 1);
}

/* ── Desktop / Large ─────────────────────────────────────────── */

/* ── Desktop deck layout ── */
.expanding-cards--slotted.expanding-cards--vertical {
  flex-direction: row;
  align-items: stretch;
  height: clamp(460px, 62vh, 720px);
  min-height: unset;
}

/* ================================================================
   ===== Vertical Axis page ONLY — scoped under .compass-content =====
   These rules override the shared slotted rules above and apply
   ONLY to the Vertical Axis expanding-cards page, not Style Guide.
   ================================================================ */

/* 1. Deck: auto height — grows to fit full content, no internal scroll.
      The deck is the only ExpandingCards inside .compass-content.       */
.compass-content .expanding-cards--slotted.expanding-cards--vertical {
  height: auto;
  min-height: 0;
  /* will-change: contents tells the browser to prepare a compositing layer,
     reducing layout recalc cost during the flex animation.              */
  will-change: contents;
}

/* 2. Expanded card: overflow visible so content is NOT clipped to deck height.
      The card grows naturally; the deck grows with it.                        */
.compass-content .expanding-cards--slotted.expanding-cards--vertical
  .expanding-cards__card[aria-expanded='true'] {
  overflow: visible;
}

/* 3. Expanded content: no scroll, no max-height cap, natural height.
      Transition: opacity + transform only (no layout-triggering properties). */
.compass-content .expanding-cards--slotted
  .expanding-cards__card[aria-expanded='true'] .expanding-cards__content {
  overflow-y: visible;
  overflow-x: visible;
  max-height: none;
  /* Delay fade-in slightly so card finishes widening first, then content appears.
     This removes the simultaneous reflow + paint that felt like jank.          */
  transition: opacity 220ms ease 120ms,
              transform 220ms cubic-bezier(0.2, 0.8, 0.2, 1) 120ms;
}

/* 4. Collapsed content: fade out fast before card narrows — no delay. */
.compass-content .expanding-cards--slotted
  .expanding-cards__card[aria-expanded='false'] .expanding-cards__content {
  transition: opacity 100ms ease 0ms,
              transform 100ms ease 0ms;
}

/* 5. Card flex animation: slightly slower + softer curve for page-level feel. */
.compass-content .expanding-cards--slotted .expanding-cards__card {
  transition: flex 380ms cubic-bezier(0.25, 0.46, 0.45, 0.94),
              box-shadow 260ms ease,
              border-color 260ms ease,
              background 260ms ease;
}

/* ── Card structure (slotted) ──
   FIX: display:flex + flex-direction:column so label sits above content.
   min-width:0 prevents flex blowout.                                     */
.expanding-cards--slotted.expanding-cards--vertical .expanding-cards__card {
  display: flex;
  flex-direction: column;
  min-width: 0;
}

/* ── Collapsed rail (slotted vertical) ── */
.expanding-cards--slotted.expanding-cards--vertical .expanding-cards__card[aria-expanded='false'] {
  flex: 0 0 44px;
  padding: 0;
  border-radius: 10px;
  overflow: hidden;

  /* teal gradient fill — uses var(--surface) not white for dark-mode compat */
  background: linear-gradient(
    180deg,
    color-mix(in srgb, var(--accent-fill, var(--dim-3)) 35%, var(--surface)),
    color-mix(in srgb, var(--accent-fill, var(--dim-3)) 70%, var(--surface))
  );
}

/* Collapsed content hidden — instant, no animation.
   The card's flex width is what animates, not the content height. */
.expanding-cards--slotted .expanding-cards__card[aria-expanded='false'] .expanding-cards__content {
  opacity: 0;
  overflow: hidden;
  padding: 0;
  pointer-events: none;
  max-height: 0;
  transform: translateY(4px);
  transition: opacity 150ms ease, transform 150ms ease;
}

/* Collapsed label: TOP-aligned + bold in slotted vertical rail.
   With writing-mode:vertical-rl the block axis runs top→bottom,
   so justify-content:flex-start pushes text to the top of the rail. */
.expanding-cards--slotted.expanding-cards--vertical
  .expanding-cards__card[aria-expanded='false'] .expanding-cards__label {
  flex: 1;
  display: flex;
  align-items: center;
  justify-content: flex-start;
  padding-top: 14px;
  writing-mode: vertical-rl;
  text-orientation: mixed;
  width: 100%;
  height: 100%;
  color: rgba(0, 0, 0, 0.55);
  font-weight: 800;
  font-size: 0.7rem;
  letter-spacing: 0.12em;
}

/* ── Expanded card (slotted vertical) ──
   overflow:hidden keeps content clipped to card bounds — deck stays stable.
   Content scrolls inside via overflow-y:auto on .expanding-cards__content. */
.expanding-cards--slotted.expanding-cards--vertical .expanding-cards__card[aria-expanded='true'] {
  flex: 1 1 auto;
  display: flex;
  flex-direction: column;
  min-width: 0;
  overflow: hidden;
}

/* Expanded label: hide the D# kicker in slotted vertical expanded state.
   The label is a direct child of the card (sibling of content), so we
   target it directly on [aria-expanded='true']. Collapsed rails are
   unaffected because this selector only matches aria-expanded='true'.
   .dimension-number ("SURFACE DIMENSION 5") is a separate element — NOT hidden. */
.expanding-cards--slotted.expanding-cards--vertical
  .expanding-cards__card[aria-expanded='true'] > .expanding-cards__label {
  display: none;
}

/* Expanded content — fills card height, scrolls if needed.
   No max-height animation: deck has fixed height, content fills it.
   opacity + transform are the only animated properties (no layout thrash). */
.expanding-cards--slotted .expanding-cards__card[aria-expanded='true'] .expanding-cards__content {
  max-height: 100%;
  opacity: 1;
  overflow-y: auto;
  transform: translateY(0);
  pointer-events: auto;
  padding: 0 18px 18px;
  flex: 1 1 auto;
  min-height: 0;
  overscroll-behavior: contain;
  scrollbar-width: thin;
  scrollbar-color: var(--border) transparent;
}
.expanding-cards--slotted .expanding-cards__card[aria-expanded='true'] .expanding-cards__content::-webkit-scrollbar {
  width: 4px;
}
.expanding-cards--slotted .expanding-cards__card[aria-expanded='true'] .expanding-cards__content::-webkit-scrollbar-thumb {
  background: var(--border);
  border-radius: 2px;
}

/* ── Depth accent stripe on expanded card (left border) ── */
.expanding-cards--slotted .expanding-cards__card[data-depth="5"][aria-expanded='true'] { border-left-color: var(--dim-5); }
.expanding-cards--slotted .expanding-cards__card[data-depth="4"][aria-expanded='true'] { border-left-color: var(--dim-4); }
.expanding-cards--slotted .expanding-cards__card[data-depth="3"][aria-expanded='true'] { border-left-color: var(--dim-3); }
.expanding-cards--slotted .expanding-cards__card[data-depth="2"][aria-expanded='true'] { border-left-color: var(--dim-2); }
.expanding-cards--slotted .expanding-cards__card[data-depth="1"][aria-expanded='true'] { border-left-color: var(--dim-1); }
.expanding-cards--slotted .expanding-cards__card[data-depth="0"][aria-expanded='true'] { border-left-color: var(--dim-0); }


/* ── Tabs inside slotted cards ──
   FIX: single consolidated block (was 4 duplicate .tabs__strip definitions).
   FIX: override .tabs overflow:hidden so tab content is not clipped.         */
.expanding-cards--slotted .tabs {
  margin: 0;
  border: 0;
  box-shadow: none;
  background: transparent;
  overflow: visible;
}

.expanding-cards--slotted .tabs__strip {
  position: sticky;
  top: 0;
  z-index: 3;
  background: transparent;
  border-bottom: 1px solid var(--border);
  flex-wrap: nowrap;
  overflow-x: auto;
  -webkit-overflow-scrolling: touch;
  gap: 8px;
}

.expanding-cards--slotted .tabs__panel {
  border: 0;
  background: transparent;
  padding: var(--space-sm) 0 0;
}

.expanding-cards--slotted .tabs__tab {
  white-space: nowrap;
}


/* ── Page-context helpers ── */
.dimension-strip-intro {
  font-size: 0.875rem;
  color: var(--text-2);
  margin-bottom: var(--space-md);
}


/* ── Tablet ───────────────────────────────────────────────────── */
/* No tablet-specific overrides; mobile breakpoint covers <=900px. */


/* ── Phone / iPhone ───────────────────────────────────────────── */
/* ================================================================
   ===== Vertical Axis: Expanding Cards — MOBILE (<=900px) =====
   Slotted vertical cards stack top-to-bottom.
   Collapsed rails become short horizontal bars.
   ================================================================ */
@media (max-width: 900px) {
  .expanding-cards--slotted.expanding-cards--vertical {
    flex-direction: column;
    min-height: auto;
    height: auto;
  }

  /* Collapsed rail -> short horizontal bar */
  .expanding-cards--slotted.expanding-cards--vertical .expanding-cards__card[aria-expanded='false'] {
    flex: 0 0 48px;
    flex-direction: row;
    border-radius: var(--radius-md);
  }

  /* Label reads horizontally on mobile — bold + stable */
  .expanding-cards--slotted.expanding-cards--vertical
    .expanding-cards__card[aria-expanded='false'] .expanding-cards__label {
    writing-mode: horizontal-tb;
    text-orientation: initial;
    padding: 0 var(--space-sm);
    height: 48px;
    width: auto;
    flex: 0 0 auto;
    align-items: center;
    font-weight: 800;
    font-size: 0.7rem;
    letter-spacing: 0.12em;
  }

  /* Expanded card: natural height, accent on top border */
  .expanding-cards--slotted.expanding-cards--vertical .expanding-cards__card[aria-expanded='true'] {
    flex: 0 0 auto;
    border-left-width: 1px;
    border-top: 5px solid var(--accent-fill, var(--border-accent));
  }

  /* Depth colors on top border for mobile */
  .expanding-cards--slotted .expanding-cards__card[data-depth="5"][aria-expanded='true'] { border-top-color: var(--dim-5); }
  .expanding-cards--slotted .expanding-cards__card[data-depth="4"][aria-expanded='true'] { border-top-color: var(--dim-4); }
  .expanding-cards--slotted .expanding-cards__card[data-depth="3"][aria-expanded='true'] { border-top-color: var(--dim-3); }
  .expanding-cards--slotted .expanding-cards__card[data-depth="2"][aria-expanded='true'] { border-top-color: var(--dim-2); }
  .expanding-cards--slotted .expanding-cards__card[data-depth="1"][aria-expanded='true'] { border-top-color: var(--dim-1); }
  .expanding-cards--slotted .expanding-cards__card[data-depth="0"][aria-expanded='true'] { border-top-color: var(--dim-0); }

  /* E) Mobile flat UI — .dimension-card chrome neutralized inside slotted deck.
     Scoped here so global .dimension-card usage is unaffected. */
  .expanding-cards--slotted .dimension-card {
    background: transparent;
    border: none;
    box-shadow: none;
    padding: 0;
  }

  /* Content scroll + padding on mobile */
  .expanding-cards--slotted .expanding-cards__card[aria-expanded='true'] .expanding-cards__content {
    padding: 0 var(--space-sm) var(--space-sm);
    overflow-y: auto;
    max-height: 70vh;
    overscroll-behavior: contain;
  }

  /* Tabs strip: reset margin on mobile */
  .expanding-cards--slotted .tabs__strip {
    margin: 0;
    padding: 8px 0;
  }
}


/* ================================================================
   ===== Vertical Axis: Expanding Cards — DARK MODE =====
   Fix gradient backgrounds and label contrast for dark theme.
   ================================================================ */
@media (prefers-color-scheme: dark) {
  .expanding-cards--slotted.expanding-cards--vertical .expanding-cards__card[aria-expanded='false'] {
    background: linear-gradient(
      180deg,
      color-mix(in srgb, var(--accent-fill, var(--dim-3)) 25%, var(--surface)),
      color-mix(in srgb, var(--accent-fill, var(--dim-3)) 50%, var(--surface))
    );
  }

  .expanding-cards--slotted.expanding-cards--vertical
    .expanding-cards__card[aria-expanded='false'] .expanding-cards__label {
    color: rgba(255, 255, 255, 0.65);
  }
}

/* Support .dark class toggle */
.dark .expanding-cards--slotted.expanding-cards--vertical .expanding-cards__card[aria-expanded='false'] {
  background: linear-gradient(
    180deg,
    color-mix(in srgb, var(--accent-fill, var(--dim-3)) 25%, var(--surface)),
    color-mix(in srgb, var(--accent-fill, var(--dim-3)) 50%, var(--surface))
  );
}

.dark .expanding-cards--slotted.expanding-cards--vertical
  .expanding-cards__card[aria-expanded='false'] .expanding-cards__label {
  color: rgba(255, 255, 255, 0.65);
}


/* ── Touch (hover:none) and (pointer:coarse) ──────────────────── */
/* No touch-specific overrides. */
